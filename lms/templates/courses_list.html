<%page expression_filter="h"/>
<%namespace name='static' file='static_content.html'/>
<%! from django.utils.translation import ugettext as _ %>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
% if settings.FEATURES.get('SHOW_COURSES_BY_CLASS'):
<% from course_classification.utils import get_all_categories_and_its_courses %>
<%  cats,course_class = get_all_categories_and_its_courses(courses) %>
%for categ in cats:
  ## show_opt es un campo del modelo Course Classification, que indica si la categoría y sus cursos deben o no mostrarse en la portada
  ## show_opt = 0 -> No mostrar cursos ni categoría
  ## show_opt = 1 -> Mostrar solo si la categoría tiene cursos asociados
  ## show_opt = 2 -> Mostrar cursos y categoría
  ## Esta regla identifica las categorías que deben mostrarse siempre y las que deben mostrarse solo si tienen al menos un curso
  %if categ['show_opt'] == 2 or (categ['show_opt'] == 1 and len(course_class[categ['id']]['courses']) > 0):
    <div class="row pt-4">
      <div class="col-12">
          <div class="row">
            <h1 class="alphaproject-categ-title text-left my-4 pb-2 px-5" style="display:inline">
              ${categ['name'].capitalize()}
            </h1>
          </div>
          <div class="row alpha-courses-list courses my-4 px-5">
            % if settings.FEATURES.get('COURSES_ARE_BROWSABLE'):
              <ul class="courses-listing">
                  %for course in course_class[categ['id']]['courses']:
                    <li class="courses-listing-item">
                      <%include file="course.html" args="course=course" />
                    </li>
                  %endfor
              </ul>
            % endif
          </div>
        ## Esta regla identifica los casos en que exista una categoría sin cursos que deba si o si mostrarse.
        %if (categ['show_opt'] == 2 and len(course_class[categ['id']]['courses']) == 0):
          <p class="without-courses"> ${_("No existen cursos")}</p>
        %endif
      </div>
    </div>
  %endif
%endfor
%else:
<section class="courses-container container-fluid w-100 px-5">
  <section class="highlighted-courses">
    % if settings.FEATURES.get('COURSES_ARE_BROWSABLE'):
    <section class="courses">
      <ul class="courses-listing">
            ## limiting the course number by using HOMEPAGE_COURSE_MAX as the maximum number of courses
            %for course in courses[:homepage_course_max]:
                <li class="courses-listing-item">
                    <%include file="course.html" args="course=course" />
                </li>
            %endfor
        </ul>
    </section>
      ## in case there are courses that are not shown on the homepage, a 'View all Courses' link should appear
      % if homepage_course_max and len(courses) > homepage_course_max:
        <div class="courses-more">
          <a class="courses-more-cta" href="${marketing_link('COURSES')}"> ${_("View all Courses")} </a>
        </div>
      % endif
    % endif
  </section>
</section>
%endif
